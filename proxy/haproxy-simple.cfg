global
    daemon
    log stdout local0

defaults
    mode http
    log global
    option httplog
    option dontlognull
    option forwardfor
    timeout connect 5000
    timeout client 50000
    timeout server 50000

# Stats page
listen stats
    bind *:8404
    stats enable
    stats uri /stats
    stats refresh 30s

# Frontend for LibProxy
frontend libproxy_frontend
    bind *:80
    
    # Route journal proxy requests
    acl is_nature path_beg /nature
    acl is_science path_beg /science
    acl is_lancet path_beg /lancet
    acl is_jama path_beg /jama
    
    use_backend nature_proxy if is_nature
    use_backend science_proxy if is_science
    use_backend lancet_proxy if is_lancet
    use_backend jama_proxy if is_jama
    
    default_backend libproxy_backend

# Backend for LibProxy API
backend libproxy_backend
    balance roundrobin
    option httpchk GET /api/health
    http-check expect status 200
    
    # Backend servers
    server libproxy_api backend:5000 check

# Backend for Nature journal
backend nature_proxy
    mode http
    balance roundrobin
    server nature_server www.nature.com:443 ssl verify none

# Backend for Science journal
backend science_proxy
    mode http
    balance roundrobin
    server science_server www.science.org:80

# Backend for The Lancet journal
backend lancet_proxy
    mode http
    balance roundrobin
    server lancet_server www.thelancet.com:80

# Backend for JAMA journal
backend jama_proxy
    mode http
    balance roundrobin
    server jama_server jamanetwork.com:80

